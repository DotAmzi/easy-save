"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function r(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,a){return t&&r(e.prototype,t),a&&r(e,a),e}}(),_awsSdk=require("aws-sdk"),_awsSdk2=_interopRequireDefault(_awsSdk),_os=require("os"),_os2=_interopRequireDefault(_os),_fs=require("fs"),_fs2=_interopRequireDefault(_fs);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var EasySave=function(){function r(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"aws",a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"";if(_classCallCheck(this,r),void 0===e)throw new Error("First parameter is required");if(this._local=t,this._target=a,"aws"===this._local){if(void 0===e.AWS_S3_ACCESS_KEY||null===e.AWS_S3_ACCESS_KEY||""===e.AWS_S3_ACCESS_KEY||""===e.AWS_S3_SECRET||null===e.AWS_S3_SECRET||void 0===e.AWS_S3_SECRET)throw new Error("AWS Key can not be empty");_awsSdk2.default.config.accessKeyId=e.AWS_S3_ACCESS_KEY,_awsSdk2.default.config.secretAccessKey=e.AWS_S3_SECRET,this._params=new _awsSdk2.default.S3}else this._params=e}return _createClass(r,[{key:"save",value:function(s){var o=this,l=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"base64";return new Promise(function(a,r){var t=(new Date).getTime();if("aws"===o._local){var e={Bucket:o._target,Key:t+"."+input.file.ext,Body:s,ACL:"authenticated-read",ContentEncoding:l,ContentType:input.file.type};s3.upload(e,function(e,t){e?r("Error on send file to AWS",e):a(t.Location)})}else if("local"===o._local){var n=_os2.default.homedir()+"/uploads",i=n+"/"+o._target;_fs2.default.existsSync(n)||_fs2.default.mkdirSync(n),_fs2.default.existsSync(i)||_fs2.default.mkdirSync(i),_fs2.default.writeFile(i+"/"+t+"."+input.file.ext,input.file.hash,{encoding:"base64"},function(e){e?r("Error to write file on disk",e):a(i+"/"+t+"."+input.file.ext)})}})}},{key:"getLocal",value:function(){return this._local}},{key:"getTarget",value:function(){return this._target}},{key:"getParams",value:function(){return this._params}},{key:"setLocal",value:function(e){this._local=e}},{key:"setTarget",value:function(e){this.__target=e}},{key:"setParams",value:function(e){this._params=e}}]),r}();exports.default=EasySave;